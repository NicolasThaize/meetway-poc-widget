<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test MeetWay Widget - √âv√©nement Agnostique</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        
        .test-title {
            color: #333;
            margin-bottom: 15px;
        }
        
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        
        .test-button:hover {
            background: #0056b3;
        }
        
        .test-button.success {
            background: #28a745;
        }
        
        .test-button.danger {
            background: #dc3545;
        }
        
        .log-output {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            margin-top: 15px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .widget-test-area {
            border: 2px dashed #007bff;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            text-align: center;
        }
        
        .event-simulation {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #28a745;
        }
        
        .event-simulation h4 {
            margin-top: 0;
            color: #155724;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üß™ Test MeetWay Widget - √âv√©nement Agnostique</h1>
        
        <!-- Test 1: Initialisation du widget -->
        <div class="test-section">
            <h2 class="test-title">Test 1: Initialisation du widget</h2>
            <p>Test de l'initialisation du widget avec d√©tection automatique des informations d'√©v√©nement.</p>
            
            <div class="event-simulation">
                <h4>üìã Informations d'√©v√©nement simul√©es sur cette page :</h4>
                <p><strong>Nom :</strong> <span class="event-title">Test Event 2024</span></p>
                <p><strong>Date :</strong> <span class="event-date">15 janvier 2024 √† 20h00</span></p>
                <p><strong>Lieu :</strong> <span class="event-location">Salle de Test, Paris</span></p>
                <p><strong>Prix :</strong> <span class="event-price">25‚Ç¨</span></p>
            </div>
            
            <div class="widget-test-area">
                <div id="widget-test-1"></div>
            </div>
            
            <button class="test-button" onclick="testWidgetInit()">Initialiser le widget</button>
            <button class="test-button danger" onclick="clearWidget('widget-test-1')">Effacer</button>
        </div>
        
        <!-- Test 2: D√©tection automatique -->
        <div class="test-section">
            <h2 class="test-title">Test 2: D√©tection automatique</h2>
            <p>Test de la d√©tection automatique des informations d'√©v√©nement sur la page.</p>
            
            <div class="widget-test-area">
                <div id="widget-test-2"></div>
            </div>
            
            <button class="test-button" onclick="testAutoDetection()">Tester d√©tection automatique</button>
            <button class="test-button success" onclick="showDetectedInfo()">Afficher infos d√©tect√©es</button>
            <button class="test-button danger" onclick="clearWidget('widget-test-2')">Effacer</button>
        </div>
        
        <!-- Test 3: Fonctionnalit√© covoiturage -->
        <div class="test-section">
            <h2 class="test-title">Test 3: Fonctionnalit√© covoiturage</h2>
            <p>Test de la checkbox de covoiturage avec informations d'√©v√©nement d√©tect√©es.</p>
            
            <div class="widget-test-area">
                <div id="widget-test-3"></div>
            </div>
            
            <button class="test-button" onclick="testCarpoolFunction()">Tester covoiturage</button>
            <button class="test-button danger" onclick="clearWidget('widget-test-3')">Effacer</button>
        </div>
        
        <!-- Logs -->
        <div class="test-section">
            <h2 class="test-title">Logs de test</h2>
            <button class="test-button" onclick="clearLogs()">Effacer les logs</button>
            <div id="log-output" class="log-output"></div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="widget.js"></script>
    <script>
        // Variables globales pour les tests
        let testWidget2 = null;
        let testWidget3 = null;
        
        // Fonction pour logger les messages
        function log(message) {
            const logOutput = document.getElementById('log-output');
            const timestamp = new Date().toLocaleTimeString();
            logOutput.innerHTML += `[${timestamp}] ${message}\n`;
            logOutput.scrollTop = logOutput.scrollHeight;
            console.log(message);
        }
        
        // Fonction pour effacer un widget
        function clearWidget(containerId) {
            const container = document.getElementById(containerId);
            if (container) {
                container.innerHTML = '';
                log(`Widget ${containerId} effac√©`);
            }
        }
        
        // Fonction pour effacer les logs
        function clearLogs() {
            document.getElementById('log-output').innerHTML = '';
        }
        
        // Test 1: Initialisation du widget
        function testWidgetInit() {
            log('üß™ Test 1: Initialisation du widget...');
            
            try {
                MeetWayWidget.init({
                    containerId: 'widget-test-1',
                    widgetTitle: 'MeetWay',
                    carpoolValue: 'Partagez votre trajet et √©conomisez !',
                    onCarpoolInterest: function(isInterested, eventInfo) {
                        log(`üöó Int√©r√™t covoiturage: ${isInterested}`);
                        log(`üìã Infos √©v√©nement: ${JSON.stringify(eventInfo)}`);
                    }
                });
                
                log('‚úÖ Widget initialis√© avec succ√®s');
            } catch (error) {
                log(`‚ùå Erreur lors de l'initialisation: ${error.message}`);
            }
        }
        
        // Test 2: D√©tection automatique
        function testAutoDetection() {
            log('üß™ Test 2: Test de d√©tection automatique...');
            
            try {
                MeetWayWidget.init({
                    containerId: 'widget-test-2',
                    widgetTitle: 'MeetWay',
                    carpoolValue: 'D√©tection automatique en cours...',
                    onCarpoolInterest: function(isInterested, eventInfo) {
                        log(`üöó Callback avec infos d√©tect√©es: ${isInterested}`);
                        log(`üìã Nom: ${eventInfo.name || 'Non d√©tect√©'}`);
                        log(`üìÖ Date: ${eventInfo.date || 'Non d√©tect√©'}`);
                        log(`üìç Lieu: ${eventInfo.location || 'Non d√©tect√©'}`);
                        log(`üí∞ Prix: ${eventInfo.price || 'Non d√©tect√©'}`);
                        log(`üåê URL: ${eventInfo.url}`);
                        log(`üìÑ Titre page: ${eventInfo.pageTitle}`);
                    }
                });
                
                log('‚úÖ Widget avec d√©tection automatique initialis√©');
            } catch (error) {
                log(`‚ùå Erreur: ${error.message}`);
            }
        }
        
        function showDetectedInfo() {
            log('üîç Affichage des informations d√©tect√©es...');
            
            try {
                const eventInfo = MeetWayWidget.getDetectedEventInfo();
                log(`üìã Nom d√©tect√©: ${eventInfo.name || 'Non d√©tect√©'}`);
                log(`üìÖ Date d√©tect√©e: ${eventInfo.date || 'Non d√©tect√©'}`);
                log(`üìç Lieu d√©tect√©: ${eventInfo.location || 'Non d√©tect√©'}`);
                log(`üí∞ Prix d√©tect√©: ${eventInfo.price || 'Non d√©tect√©'}`);
                log(`üåê URL: ${eventInfo.url}`);
                log(`üìÑ Titre page: ${eventInfo.pageTitle}`);
            } catch (error) {
                log(`‚ùå Erreur lors de la r√©cup√©ration: ${error.message}`);
            }
        }
        
        // Test 3: Fonctionnalit√© covoiturage
        function testCarpoolFunction() {
            log('üß™ Test 3: Test de la fonctionnalit√© covoiturage...');
            
            try {
                MeetWayWidget.init({
                    containerId: 'widget-test-3',
                    widgetTitle: 'MeetWay',
                    carpoolValue: 'Testez la checkbox de covoiturage !',
                    onCarpoolInterest: function(isInterested, eventInfo) {
                        log(`üöó Callback covoiturage appel√©: ${isInterested}`);
                        log(`üìã √âv√©nement: ${eventInfo.name || 'Non d√©tect√©'}`);
                        
                        // Simulation d'un appel API
                        setTimeout(() => {
                            if (isInterested) {
                                log('üì° Appel API simul√© - Int√©r√™t enregistr√©');
                                log(`üìä Donn√©es envoy√©es: ${JSON.stringify(eventInfo)}`);
                            } else {
                                log('üì° Appel API simul√© - Int√©r√™t retir√©');
                            }
                        }, 1000);
                    }
                });
                
                log('‚úÖ Widget covoiturage initialis√© - Testez la checkbox !');
            } catch (error) {
                log(`‚ùå Erreur: ${error.message}`);
            }
        }
        
        // Tests automatiques au chargement
        document.addEventListener('DOMContentLoaded', function() {
            log('üöÄ Page de test charg√©e');
            log('üìã Tests disponibles:');
            log('  1. Initialisation du widget');
            log('  2. D√©tection automatique des informations');
            log('  3. Fonctionnalit√© covoiturage');
            log('üí° Cliquez sur les boutons pour lancer les tests');
            log('üîç Le widget d√©tecte automatiquement les informations d\'√©v√©nement sur cette page');
        });
    </script>
</body>
</html>
